<!-- chat_template.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Chat</title>
    <style>
        .container {
            display: flex;
        }

        .chat-window {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            margin-right: 10px;
            height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="chat-window" id="messages1"></div>
        <div class="chat-window" id="messages2"></div>
    </div>
    <form action="" onsubmit="sendMessage(event)">
        <textarea id="messageInput" rows="10" cols="50" autocomplete="off"></textarea>
        <button>Send</button>
    </form>
    <script>
        var ws = new WebSocket("ws://localhost:8000/");
        var lastMessageElement = null;
        var currentWindow = 1;

        ws.onmessage = function (event) {
            if (lastMessageElement == null) {
                lastMessageElement = document.createElement('p');
                document.getElementById('messages' + currentWindow).appendChild(lastMessageElement);
            }
            var dataJson = JSON.parse(event.data);
            lastMessageElement.innerHTML += dataJson.content;
            if (dataJson.end) {
                lastMessageElement.innerHTML += '<br>';

                // next Window
                currentWindow = currentWindow === 1 ? 2 : 1;
                lastMessageElement = document.createElement('p');
                var nextMessagesContainer = document.getElementById('messages' + currentWindow);
                nextMessagesContainer.appendChild(lastMessageElement);
                nextMessagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        };

        function sendMessage(event) {
            event.preventDefault();
            var input = document.getElementById("messageInput");
            var message = input.value;
            ws.send(JSON.stringify({ type: "message", content: message }));
            var userMessageElement = document.createElement('p');
            userMessageElement.innerHTML = '<b>' + input.value + '</b><br>';

            var messagesContainer = document.getElementById('messages' + currentWindow);
            messagesContainer.appendChild(userMessageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            input.value = '';
        }
    </script>
</body>

</html>